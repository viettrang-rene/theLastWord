<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Puzzle Fun! - Crossword & Word Search Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        /* [Previous CSS styles remain the same] */
        body {
            font-family: 'Arial', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
        }
        
        .container {
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        /* [Rest of your existing CSS styles...] */
    </style>
</head>
<body>
    <!-- [Previous HTML structure remains the same] -->
    <div class="container">
        <h1>Puzzle Fun!</h1>
        <p class="subtitle">Create custom crossword and word search puzzles</p>
        
        <!-- [Rest of your existing HTML...] -->
    </div>

    <script>
        // [Previous theme and word bank definitions remain the same]
        const themes = {
            'easy-animals': ['cat', 'dog', 'fish', 'bird', 'frog', 'bear', 'lion', 'duck'],
            'farm-animals': ['cow', 'pig', 'goat', 'sheep', 'horse', 'chicken', 'duck', 'turkey'],
            'ocean-animals': ['whale', 'shark', 'dolphin', 'octopus', 'seal', 'jellyfish', 'starfish', 'turtle']
        };

        // Improved PDF generation function
        async function generatePDF() {
            const words = getWords();
            if (!words) return;

            try {
                // Check if jsPDF is loaded
                if (typeof window.jspdf === 'undefined') {
                    showError('PDF library failed to load. Please refresh the page.');
                    return;
                }

                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Set safe margins
                const margin = 15;
                let yPosition = margin;
                
                // Add header
                doc.setFontSize(24);
                doc.setTextColor(40, 40, 40);
                doc.text('Puzzle Fun!', 105, yPosition, { align: 'center' });
                yPosition += 10;
                
                doc.setFontSize(12);
                doc.text('Made by Rene', 105, yPosition, { align: 'center' });
                yPosition += 10;
                
                doc.setFontSize(14);
                doc.text('Student name: _________________', 105, yPosition, { align: 'center' });
                yPosition += 20;

                // Generate crossword
                const crossword = generateCrossword(words);
                if (!crossword || !crossword.grid) {
                    showError('Failed to generate crossword. Please try different words.');
                    return;
                }

                // Add crossword section
                doc.setFontSize(16);
                doc.text('Crossword Puzzle', margin, yPosition);
                yPosition += 10;

                // Draw crossword grid
                const cellSize = 5;
                const gridWidth = crossword.size * cellSize;
                const gridStartX = margin + (doc.internal.pageSize.width - 2 * margin - gridWidth) / 2;
                
                // Ensure crossword fits on page
                if (yPosition + crossword.size * cellSize > doc.internal.pageSize.height - 50) {
                    doc.addPage();
                    yPosition = margin;
                }

                for (let i = 0; i < crossword.size; i++) {
                    for (let j = 0; j < crossword.size; j++) {
                        const x = gridStartX + j * cellSize;
                        const y = yPosition + i * cellSize;
                        
                        if (crossword.grid[i][j] === '') {
                            doc.setFillColor(0, 0, 0);
                            doc.rect(x, y, cellSize, cellSize, 'F');
                        } else {
                            doc.rect(x, y, cellSize, cellSize);
                            
                            // Add number
                            const coord = `${i},${j}`;
                            if (crossword.numbers[coord]) {
                                doc.setFontSize(6);
                                doc.text(crossword.numbers[coord].toString(), x + 1, y + 2);
                            }
                            
                            // Add letter
                            doc.setFontSize(10);
                            doc.text(crossword.grid[i][j], x + cellSize/2, y + cellSize/2 + 1, { align: 'center' });
                        }
                    }
                }
                
                yPosition += crossword.size * cellSize + 15;

                // Add clues
                doc.setFontSize(12);
                doc.text('Clues:', margin, yPosition);
                yPosition += 7;

                // Split clues into columns if needed
                const cluesPerColumn = Math.floor((doc.internal.pageSize.height - yPosition - 20) / 7);
                const columnWidth = 90;
                let column = 0;
                
                words.forEach((word, index) => {
                    if (yPosition > doc.internal.pageSize.height - 20) {
                        doc.addPage();
                        yPosition = margin;
                        column = 0;
                    }
                    
                    if (index > 0 && index % cluesPerColumn === 0) {
                        column++;
                        yPosition = margin + 30; // Below the title
                    }
                    
                    doc.text(`${index + 1}. ${scrambleWord(word.toLowerCase())} (${word.length} letters)`, 
                            margin + column * columnWidth, 
                            yPosition);
                    yPosition += 7;
                });

                // Add word search section (on a new page)
                doc.addPage();
                yPosition = margin;
                
                doc.setFontSize(16);
                doc.text('Word Search', margin, yPosition);
                yPosition += 10;

                // Generate word search
                const wordsearch = generateWordSearch(words);
                if (!wordsearch || !wordsearch.grid) {
                    showError('Failed to generate word search. Please try different words.');
                    return;
                }

                // Draw word search grid
                const wsCellSize = 5;
                const wsGridWidth = wordsearch.size * wsCellSize;
                const wsGridStartX = margin + (doc.internal.pageSize.width - 2 * margin - wsGridWidth) / 2;
                
                // Ensure word search fits on page
                if (yPosition + wordsearch.size * wsCellSize > doc.internal.pageSize.height - 50) {
                    doc.addPage();
                    yPosition = margin;
                }

                for (let i = 0; i < wordsearch.size; i++) {
                    for (let j = 0; j < wordsearch.size; j++) {
                        const x = wsGridStartX + j * wsCellSize;
                        const y = yPosition + i * wsCellSize;
                        
                        doc.rect(x, y, wsCellSize, wsCellSize);
                        doc.setFontSize(10);
                        doc.text(wordsearch.grid[i][j], x + wsCellSize/2, y + wsCellSize/2 + 1, { align: 'center' });
                    }
                }
                
                yPosition += wordsearch.size * wsCellSize + 10;

                // Add word bank
                doc.setFontSize(12);
                doc.text('Word Bank:', margin, yPosition);
                doc.text(words.join(', ').toUpperCase(), margin, yPosition + 7);

                // Add theme color if selected
                if (currentTheme) {
                    doc.setDrawColor(themeColors[currentTheme]);
                    doc.setLineWidth(1);
                    doc.rect(5, 5, doc.internal.pageSize.width - 10, doc.internal.pageSize.height - 10);
                }

                // Save the PDF
                doc.save('puzzle-fun.pdf');

                // Update previews
                updatePreviews();

            } catch (error) {
                console.error('PDF Generation Error:', error);
                showError('An error occurred while generating the PDF. Please try with fewer or shorter words.');
            }
        }

        // [Rest of your existing JavaScript functions...]
    </script>
</body>
</html>
