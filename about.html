<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Puzzle Fun! - Crossword & Word Search Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
        }
        
        .container {
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .input-section {
            margin-bottom: 20px;
        }
        
        textarea {
            width: 100%;
            height: 150px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            resize: vertical;
            font-size: 16px;
        }
        
        .theme-buttons {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .theme-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
        }
        
        .theme-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .easy-animals {
            background-color: #2ecc71;
            color: white;
        }
        
        .farm-animals {
            background-color: #8b4513;
            color: white;
        }
        
        .ocean-animals {
            background-color: #3498db;
            color: white;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .generate-btn, .reset-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        
        .generate-btn {
            background-color: #e74c3c;
            color: white;
        }
        
        .reset-btn {
            background-color: #95a5a6;
            color: white;
        }
        
        .error-message {
            color: #e74c3c;
            margin-top: 10px;
            font-weight: bold;
        }
        
        .preview {
            margin-top: 30px;
            border-top: 1px solid #ddd;
            padding-top: 20px;
        }
        
        .pdf-preview {
            width: 100%;
            height: 500px;
            border: 1px solid #ddd;
            margin-top: 20px;
            display: none;
        }
        
        @media print {
            .no-print {
                display: none;
            }
        }
        
        .crossword-grid {
            display: grid;
            grid-template-columns: repeat(10, 25px);
            grid-gap: 1px;
            margin: 20px 0;
        }
        
        .crossword-cell {
            width: 25px;
            height: 25px;
            border: 1px solid #000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            position: relative;
        }
        
        .crossword-cell.black {
            background-color: #000;
        }
        
        .crossword-number {
            position: absolute;
            font-size: 8px;
            top: 1px;
            left: 2px;
        }
        
        .wordsearch-grid {
            display: grid;
            grid-template-columns: repeat(15, 25px);
            grid-gap: 1px;
            margin: 20px 0;
        }
        
        .wordsearch-cell {
            width: 25px;
            height: 25px;
            border: 1px solid #000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        
        .puzzle-section {
            margin-bottom: 30px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Puzzle Fun!</h1>
        <p class="subtitle">Create custom crossword and word search puzzles</p>
        
        <div class="input-section">
            <label for="word-input">Enter your words (one per line or comma separated):</label>
            <textarea id="word-input" placeholder="e.g., apple, banana, dolphin, elephant, giraffe, kangaroo, octopus, rabbit"></textarea>
            
            <p>Or choose a premade theme:</p>
            <div class="theme-buttons">
                <button class="theme-btn easy-animals" onclick="loadTheme('easy-animals')">Easy Animals</button>
                <button class="theme-btn farm-animals" onclick="loadTheme('farm-animals')">Farm Animals</button>
                <button class="theme-btn ocean-animals" onclick="loadTheme('ocean-animals')">Ocean Animals</button>
            </div>
            
            <div class="action-buttons">
                <button class="generate-btn" onclick="generatePDF()">Generate PDF</button>
                <button class="reset-btn" onclick="resetForm()">Reset</button>
            </div>
            
            <div id="error-message" class="error-message"></div>
        </div>
        
        <div class="preview no-print">
            <h3>Preview</h3>
            <div id="crossword-preview" class="puzzle-section"></div>
            <div id="wordsearch-preview" class="puzzle-section"></div>
            <div id="pdf-preview" class="pdf-preview"></div>
        </div>
    </div>

    <script>
        // Theme word banks
        const themes = {
            'easy-animals': ['cat', 'dog', 'fish', 'bird', 'frog', 'bear', 'lion', 'duck'],
            'farm-animals': ['cow', 'pig', 'goat', 'sheep', 'horse', 'chicken', 'duck', 'turkey'],
            'ocean-animals': ['whale', 'shark', 'dolphin', 'octopus', 'seal', 'jellyfish', 'starfish', 'turtle']
        };
        
        // Theme colors
        const themeColors = {
            'easy-animals': '#2ecc71',
            'farm-animals': '#8b4513',
            'ocean-animals': '#3498db'
        };
        
        let currentTheme = null;
        
        // Load a premade theme
        function loadTheme(theme) {
            currentTheme = theme;
            const words = themes[theme].join(', ');
            document.getElementById('word-input').value = words;
            
            // Change container border color
            document.querySelector('.container').style.borderTop = `5px solid ${themeColors[theme]}`;
            
            // Clear any errors
            document.getElementById('error-message').textContent = '';
            
            // Update preview
            updatePreviews();
        }
        
        // Reset the form
        function resetForm() {
            document.getElementById('word-input').value = '';
            document.getElementById('error-message').textContent = '';
            document.querySelector('.container').style.borderTop = '';
            document.getElementById('pdf-preview').style.display = 'none';
            document.getElementById('crossword-preview').innerHTML = '';
            document.getElementById('wordsearch-preview').innerHTML = '';
            currentTheme = null;
        }
        
        // Validate and parse input words
        function getWords() {
            const input = document.getElementById('word-input').value.trim();
            if (!input) {
                showError('Please enter some words or select a theme.');
                return null;
            }
            
            // Split by commas or newlines
            let words = input.split(/[\n,]+/).map(word => word.trim()).filter(word => word);
            
            // Validate each word
            for (const word of words) {
                if (!/^[a-zA-Z]+$/.test(word)) {
                    showError(`"${word}" contains invalid characters. Only letters allowed.`);
                    return null;
                }
                if (word.length > 12) {
                    showError(`"${word}" is too long. Maximum 12 letters per word.`);
                    return null;
                }
            }
            
            // Limit to 12 words max
            if (words.length > 12) {
                showError('Maximum 12 words allowed. Using first 12 words.');
                words = words.slice(0, 12);
            }
            
            return words;
        }
        
        // Display error message
        function showError(message) {
            document.getElementById('error-message').textContent = message;
        }
        
        // Scramble a word
        function scrambleWord(word) {
            return word.split('').sort(() => 0.5 - Math.random()).join('');
        }
        
        // Generate a simple crossword grid
        function generateCrossword(words) {
            // Sort words by length (longest first)
            words = words.slice().sort((a, b) => b.length - a.length);
            
            // Create a grid (size based on longest word)
            const size = Math.max(10, ...words.map(word => word.length)) + 2;
            const grid = Array(size).fill().map(() => Array(size).fill(''));
            const isBlack = Array(size).fill().map(() => Array(size).fill(false));
            const numbers = {};
            let wordNumber = 1;
            
            // Place first word horizontally in center
            const firstWord = words[0];
            const startRow = Math.floor(size / 2);
            const startCol = Math.floor((size - firstWord.length) / 2);
            
            for (let i = 0; i < firstWord.length; i++) {
                grid[startRow][startCol + i] = firstWord[i].toUpperCase();
            }
            numbers[`${startRow},${startCol}`] = wordNumber++;
            
            // Place remaining words
            for (let w = 1; w < words.length; w++) {
                const word = words[w];
                let placed = false;
                
                // Try to place word intersecting with existing letters
                for (let i = 0; i < word.length && !placed; i++) {
                    for (let r = 0; r < size && !placed; r++) {
                        for (let c = 0; c < size && !placed; c++) {
                            if (grid[r][c] === word[i].toUpperCase()) {
                                // Try vertical placement
                                const startR = r - i;
                                if (startR >= 0 && startR + word.length <= size) {
                                    let canPlace = true;
                                    
                                    // Check if the space is available
                                    for (let j = 0; j < word.length; j++) {
                                        if (j !== i && grid[startR + j][c] !== '' && 
                                            grid[startR + j][c] !== word[j].toUpperCase()) {
                                            canPlace = false;
                                            break;
                                        }
                                    }
                                    
                                    if (canPlace) {
                                        // Place the word
                                        numbers[`${startR},${c}`] = wordNumber++;
                                        for (let j = 0; j < word.length; j++) {
                                            grid[startR + j][c] = word[j].toUpperCase();
                                        }
                                        placed = true;
                                    }
                                }
                            }
                        }
                    }
                }
            }
            
            // Mark empty cells as black
            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size; j++) {
                    if (grid[i][j] === '') {
                        isBlack[i][j] = true;
                    }
                }
            }
            
            return { grid, numbers, size, isBlack };
        }
        
        // Generate word search grid
        function generateWordSearch(words) {
            const gridSize = Math.max(15, ...words.map(word => word.length)) + 2;
            let grid = Array(gridSize).fill().map(() => Array(gridSize).fill(''));
            
            // Place words in grid
            words.forEach(word => {
                word = word.toUpperCase();
                let placed = false;
                let attempts = 0;
                
                while (!placed && attempts < 100) {
                    attempts++;
                    const direction = Math.floor(Math.random() * 3); // 0=horizontal, 1=vertical, 2=diagonal
                    let row, col;
                    
                    if (direction === 0) { // horizontal
                        row = Math.floor(Math.random() * gridSize);
                        col = Math.floor(Math.random() * (gridSize - word.length));
                        
                        let canPlace = true;
                        for (let i = 0; i < word.length; i++) {
                            if (grid[row][col + i] !== '' && grid[row][col + i] !== word[i]) {
                                canPlace = false;
                                break;
                            }
                        }
                        
                        if (canPlace) {
                            for (let i = 0; i < word.length; i++) {
                                grid[row][col + i] = word[i];
                            }
                            placed = true;
                        }
                    } 
                    else if (direction === 1) { // vertical
                        row = Math.floor(Math.random() * (gridSize - word.length));
                        col = Math.floor(Math.random() * gridSize);
                        
                        let canPlace = true;
                        for (let i = 0; i < word.length; i++) {
                            if (grid[row + i][col] !== '' && grid[row + i][col] !== word[i]) {
                                canPlace = false;
                                break;
                            }
                        }
                        
                        if (canPlace) {
                            for (let i = 0; i < word.length; i++) {
                                grid[row + i][col] = word[i];
                            }
                            placed = true;
                        }
                    } 
                    else { // diagonal
                        row = Math.floor(Math.random() * (gridSize - word.length));
                        col = Math.floor(Math.random() * (gridSize - word.length));
                        
                        let canPlace = true;
                        for (let i = 0; i < word.length; i++) {
                            if (grid[row + i][col + i] !== '' && grid[row + i][col + i] !== word[i]) {
                                canPlace = false;
                                break;
                            }
                        }
                        
                        if (canPlace) {
                            for (let i = 0; i < word.length; i++) {
                                grid[row + i][col + i] = word[i];
                            }
                            placed = true;
                        }
                    }
                }
            });
            
            // Fill empty spaces with random letters
            const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    if (grid[i][j] === '') {
                        grid[i][j] = letters[Math.floor(Math.random() * letters.length)];
                    }
                }
            }
            
            return { grid, size: gridSize };
        }
        
        // Update the preview sections
        function updatePreviews() {
            const words = getWords();
            if (!words || words.length === 0) {
                document.getElementById('crossword-preview').innerHTML = '';
                document.getElementById('wordsearch-preview').innerHTML = '';
                return;
            }
            
            try {
                // Crossword preview
                const crossword = generateCrossword(words);
                const crosswordPreview = document.getElementById('crossword-preview');
                crosswordPreview.innerHTML = '<h4>Crossword Preview</h4>';
                
                const crosswordGrid = document.createElement('div');
                crosswordGrid.className = 'crossword-grid';
                crosswordGrid.style.gridTemplateColumns = `repeat(${crossword.size}, 25px)`;
                
                for (let i = 0; i < crossword.size; i++) {
                    for (let j = 0; j < crossword.size; j++) {
                        const cell = document.createElement('div');
                        cell.className = 'crossword-cell';
                        
                        if (crossword.isBlack[i][j]) {
                            cell.classList.add('black');
                        } else {
                            cell.textContent = crossword.grid[i][j];
                            
                            const coord = `${i},${j}`;
                            if (crossword.numbers[coord]) {
                                const number = document.createElement('span');
                                number.className = 'crossword-number';
                                number.textContent = crossword.numbers[coord];
                                cell.appendChild(number);
                            }
                        }
                        
                        crosswordGrid.appendChild(cell);
                    }
                }
                
                crosswordPreview.appendChild(crosswordGrid);
                
                // Clues
                const clues = document.createElement('div');
                clues.innerHTML = '<h5>Clues:</h5><ol>';
                
                words.forEach((word, index) => {
                    clues.innerHTML += `<li>${scrambleWord(word.toLowerCase())} (${word.length} letters)</li>`;
                });
                
                clues.innerHTML += '</ol>';
                crosswordPreview.appendChild(clues);
                
                // Word search preview
                const wordsearch = generateWordSearch(words);
                const wordsearchPreview = document.getElementById('wordsearch-preview');
                wordsearchPreview.innerHTML = '<h4>Word Search Preview</h4>';
                
                const wordsearchGrid = document.createElement('div');
                wordsearchGrid.className = 'wordsearch-grid';
                wordsearchGrid.style.gridTemplateColumns = `repeat(${wordsearch.size}, 25px)`;
                
                for (let i = 0; i < wordsearch.size; i++) {
                    for (let j = 0; j < wordsearch.size; j++) {
                        const cell = document.createElement('div');
                        cell.className = 'wordsearch-cell';
                        cell.textContent = wordsearch.grid[i][j];
                        wordsearchGrid.appendChild(cell);
                    }
                }
                
                wordsearchPreview.appendChild(wordsearchGrid);
                
                // Word bank
                const wordBank = document.createElement('div');
                wordBank.innerHTML = `<h5>Word Bank:</h5><p>${words.join(', ').toUpperCase()}</p>`;
                wordsearchPreview.appendChild(wordBank);
                
            } catch (error) {
                console.error('Preview generation error:', error);
                showError('Could not generate preview. Please try different words.');
            }
        }
        
        // Generate the PDF
        async function generatePDF() {
            const words = getWords();
            if (!words || words.length === 0) return;
            
            try {
                // Check if jsPDF is loaded
                if (typeof window.jspdf === 'undefined') {
                    showError('PDF library failed to load. Please refresh the page.');
                    return;
                }

                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Set safe margins
                const margin = 15;
                let yPosition = margin;
                
                // Add header
                doc.setFontSize(24);
                doc.setTextColor(40, 40, 40);
                doc.text('Puzzle Fun!', 105, yPosition, { align: 'center' });
                yPosition += 10;
                
                doc.setFontSize(12);
                doc.text('Made by Rene', 105, yPosition, { align: 'center' });
                yPosition += 10;
                
                doc.setFontSize(14);
                doc.text('Student name: _________________', 105, yPosition, { align: 'center' });
                yPosition += 20;

                // Generate crossword
                const crossword = generateCrossword(words);
                if (!crossword || !crossword.grid) {
                    showError('Failed to generate crossword. Please try different words.');
                    return;
                }

                // Add crossword section
                doc.setFontSize(16);
                doc.text('Crossword Puzzle', margin, yPosition);
                yPosition += 10;

                // Draw crossword grid
                const cellSize = 5;
                const gridWidth = crossword.size * cellSize;
                const gridStartX = margin + (doc.internal.pageSize.width - 2 * margin - gridWidth) / 2;
                
                // Ensure crossword fits on page
                if (yPosition + crossword.size * cellSize > doc.internal.pageSize.height - 50) {
                    doc.addPage();
                    yPosition = margin;
                }

                for (let i = 0; i < crossword.size; i++) {
                    for (let j = 0; j < crossword.size; j++) {
                        const x = gridStartX + j * cellSize;
                        const y = yPosition + i * cellSize;
                        
                        if (crossword.isBlack[i][j]) {
                            doc.setFillColor(0, 0, 0);
                            doc.rect(x, y, cellSize, cellSize, 'F');
                        } else {
                            doc.rect(x, y, cellSize, cellSize);
                            
                            // Add number
                            const coord = `${i},${j}`;
                            if (crossword.numbers[coord]) {
                                doc.setFontSize(6);
                                doc.text(crossword.numbers[coord].toString(), x + 1, y + 2);
                            }
                            
                            // Add letter
                            doc.setFontSize(10);
                            doc.text(crossword.grid[i][j], x + cellSize/2, y + cellSize/2 + 1, { align: 'center' });
                        }
                    }
                }
                
                yPosition += crossword.size * cellSize + 15;

                // Add clues
                doc.setFontSize(12);
                doc.text('Clues:', margin, yPosition);
                yPosition += 7;

                // Split clues into columns if needed
                const cluesPerColumn = Math.floor((doc.internal.pageSize.height - yPosition - 20) / 7);
                const columnWidth = 90;
                let column = 0;
                
                words.forEach((word, index) => {
                    if (yPosition > doc.internal.pageSize.height - 20) {
                        doc.addPage();
                        yPosition = margin;
                        column = 0;
                    }
                    
                    if (index > 0 && index % cluesPerColumn === 0) {
                        column++;
                        yPosition = margin + 30; // Below the title
                    }
                    
                    doc.text(`${index + 1}. ${scrambleWord(word.toLowerCase())} (${word.length} letters)`, 
                            margin + column * columnWidth, 
                            yPosition);
                    yPosition += 7;
                });

                // Add word search section (on a new page)
                doc.addPage();
                yPosition = margin;
                
                doc.setFontSize(16);
                doc.text('Word Search', margin, yPosition);
                yPosition += 10;

                // Generate word search
                const wordsearch = generateWordSearch(words);
                if (!wordsearch || !wordsearch.grid) {
                    showError('Failed to generate word search. Please try different words.');
                    return;
                }

                // Draw word search grid
                const wsCellSize = 5;
                const wsGridWidth = wordsearch.size * wsCellSize;
                const wsGridStartX = margin + (doc.internal.pageSize.width - 2 * margin - wsGridWidth) / 2;
                
                // Ensure word search fits on page
                if (yPosition + wordsearch.size * wsCellSize > doc.internal.pageSize.height - 50) {
                    doc.addPage();
                    yPosition = margin;
                }

                for (let i = 0; i < wordsearch.size; i++) {
                    for (let j = 0; j < wordsearch.size; j++) {
                        const x = wsGridStartX + j * wsCellSize;
                        const y = yPosition + i * wsCellSize;
                        
                        doc.rect(x, y, wsCellSize, wsCellSize);
                        doc.setFontSize(10);
                        doc.text(wordsearch.grid[i][j], x + wsCellSize/2, y + wsCellSize/2 + 1, { align: 'center' });
                    }
                }
                
                yPosition += wordsearch.size * wsCellSize + 10;

                // Add word bank
                doc.setFontSize(12);
                doc.text('Word Bank:', margin, yPosition);
                doc.text(words.join(', ').toUpperCase(), margin, yPosition + 7);

                // Add theme color if selected
                if (currentTheme) {
                    doc.setDrawColor(themeColors[currentTheme]);
                    doc.setLineWidth(1);
                    doc.rect(5, 5, doc.internal.pageSize.width - 10, doc.internal.pageSize.height - 10);
                }

                // Save the PDF
                doc.save('puzzle-fun.pdf');

            } catch (error) {
                console.error('PDF Generation Error:', error);
                showError('An error occurred while generating the PDF. Please try with fewer or shorter words.');
            }
        }

        // Update preview when typing
        document.getElementById('word-input').addEventListener('input', function() {
            currentTheme = null;
            document.querySelector('.container').style.borderTop = '';
            updatePreviews();
        });

        // Initialize with empty previews
        updatePreviews();
    </script>
</body>
</html>
